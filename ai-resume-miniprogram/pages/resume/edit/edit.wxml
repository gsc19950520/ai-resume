<!-- edit.wxml -->
<view class="container">

  <!-- 编辑部分导航 -->
  <scroll-view class="section-nav" scroll-x>
    <view class="nav-item" wx:for="{{sections}}" wx:key="id" 
          class="nav-item {{currentSection === item.id ? 'active' : ''}}" 
          bindtap="switchSection" data-id="{{item.id}}">
      <text>{{item.name}}</text>
    </view>
    <!-- 确保兴趣爱好选项在sections数组中存在 -->
  </scroll-view>

  <!-- 编辑内容区域 -->
  <scroll-view class="content" scroll-y>
    <!-- 个人信息部分 -->
    <view class="edit-section" wx:if="{{currentSection === 'personal'}}">
      <!-- 只读个人信息 -->
      <view class="readonly-section">
        <view class="form-item readonly-item">
          <text class="label">姓名</text>
          <view class="readonly-text">{{userInfo.name || '未设置'}}</view>
        </view>
        
        <view class="form-item readonly-item">
          <text class="label">电话</text>
          <view class="readonly-text">{{userInfo.phone || '未设置'}}</view>
        </view>
        
        <view class="form-item readonly-item">
          <text class="label">邮箱</text>
          <view class="readonly-text">{{userInfo.email || '未设置'}}</view>
        </view>
        
        <view class="form-item readonly-item">
          <text class="label">地址</text>
          <view class="readonly-text">{{userInfo.address || '未设置'}}</view>
        </view>
        
        <view class="form-item readonly-item">
          <text class="label">出生日期</text>
          <view class="readonly-text">{{userInfo.birthDate || '未设置'}}</view>
        </view>
      </view>
      
      <!-- 可编辑的简历相关信息 -->
      <view class="editable-section">
        <view class="section-title">简历编辑</view>
        
        <view class="form-item">
          <text class="label">职位</text>
          <input class="input" placeholder="请输入求职职位" value="{{resumeInfo.personalInfo.jobTitle}}" bindinput="savePersonalInfo" data-field="jobTitle" />
        </view>
        
        <view class="form-item">
          <text class="label">职位类型</text>
          <picker bindchange="onJobTypeChange" value="{{resumeInfo.personalInfo.jobTypeId}}" range="{{jobTypes}}" range-key="name">
            <view class="picker">
              {{resumeInfo.personalInfo.jobTitle || '请选择职位类型'}}
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="label">期望薪资</text>
          <input class="input" placeholder="请输入您的期望薪资（如：15k-20k）" value="{{resumeInfo.personalInfo.expectedSalary}}" bindinput="savePersonalInfo" data-field="expectedSalary" />
        </view>
        
        <view class="form-item">
          <text class="label">到岗时间</text>
          <input class="input" placeholder="请输入您的可到岗时间（如：一周内、一个月内）" value="{{resumeInfo.personalInfo.startTime}}" bindinput="savePersonalInfo" data-field="startTime" />
        </view>
      </view>
      
      <view class="tips">
        <text>提示：个人基本信息已移至用户中心管理，此处仅可查看</text>
      </view>
    </view>

    <!-- 教育经历部分 -->
      <view class="edit-section" wx:if="{{currentSection === 'education'}}">
        <view class="education-item" wx:for="{{resumeInfo.education}}" wx:key="id">
        <view class="item-header">
          <text class="item-title">教育经历 {{index + 1}}</text>
          <!-- 只有当项目数量大于1时才显示删除按钮 -->
          <text wx:if="{{resumeInfo.education.length > 1}}" class="delete-btn" bindtap="removeEducation" data-index="{{index}}">删除</text>
        </view>
        
        <view class="form-item">
          <text class="label">学校名称</text>
          <input class="input" placeholder="请输入学校名称" value="{{item.school}}" bindinput="onEducationInput" data-index="{{index}}" data-field="school" />
        </view>
        
        <view class="form-item">
          <text class="label">专业</text>
          <input class="input" placeholder="请输入专业名称" value="{{item.major}}" bindinput="onEducationInput" data-index="{{index}}" data-field="major" />
        </view>
        
        <view class="form-item">
          <text class="label">学历</text>
          <input class="input" placeholder="请输入学历" value="{{item.degree}}" bindinput="onEducationInput" data-index="{{index}}" data-field="degree" />
        </view>
        
        <view class="date-row">
          <view class="form-item date-item">
            <text class="label">开始时间</text>
            <input class="input" placeholder="YYYY-MM" value="{{item.startDate}}" bindinput="onEducationInput" data-index="{{index}}" data-field="startDate" />
          </view>
          
          <view class="form-item date-item">
            <text class="label">结束时间</text>
            <input class="input" placeholder="YYYY-MM" value="{{item.endDate}}" bindinput="onEducationInput" data-index="{{index}}" data-field="endDate" />
          </view>
        </view>
      </view>
      
      <button class="add-btn" bindtap="addEducation">+ 添加教育经历</button>
    </view>

    <!-- 工作经历部分 -->
      <view class="edit-section" wx:if="{{currentSection === 'work'}}">
        <view class="work-item" wx:for="{{resumeInfo.workExperience}}" wx:key="id">
        <view class="item-header">
          <text class="item-title">工作经历 {{index + 1}}</text>
          <!-- 只有当项目数量大于1时才显示删除按钮 -->
          <text wx:if="{{resumeInfo.workExperience.length > 1}}" class="delete-btn" bindtap="removeWorkExperience" data-index="{{index}}">删除</text>
        </view>
        
        <view class="form-item">
          <text class="label">公司名称</text>
          <input class="input" placeholder="请输入公司名称" value="{{item.company}}" bindinput="onWorkInput" data-index="{{index}}" data-field="company" />
        </view>
        
        <view class="form-item">
          <text class="label">职位</text>
          <input class="input" placeholder="请输入职位" value="{{item.position}}" bindinput="onWorkInput" data-index="{{index}}" data-field="position" />
        </view>
        
        <view class="date-row">
          <view class="form-item date-item">
            <text class="label">开始时间</text>
            <input class="input" placeholder="YYYY-MM" value="{{item.startDate}}" bindinput="onWorkInput" data-index="{{index}}" data-field="startDate" />
          </view>
          
          <view class="form-item date-item">
            <text class="label">结束时间</text>
            <input class="input" placeholder="YYYY-MM" value="{{item.endDate}}" bindinput="onWorkInput" data-index="{{index}}" data-field="endDate" />
          </view>
        </view>
        
        <view class="form-item">
          <text class="label">工作描述</text>
          <textarea class="textarea" placeholder="请描述您的工作职责和成就" value="{{item.description}}" bindinput="onWorkInput" data-index="{{index}}" data-field="description" />
        </view>
      </view>
      
      <button class="add-btn" bindtap="addWorkExperience">+ 添加工作经历</button>
    </view>

    <!-- 项目经验部分 -->
    <view class="edit-section" wx:if="{{currentSection === 'projects'}}">
      <view class="project-item" wx:for="{{resumeInfo.projectExperienceList}}" wx:key="id">
        <view class="item-header">
          <text class="item-title">项目经验 {{index + 1}}</text>
          <!-- 只有当项目数量大于1时才显示删除按钮 -->
          <text wx:if="{{resumeInfo.projectExperienceList.length > 1}}" class="delete-btn" bindtap="removeProjectExperience" data-index="{{index}}">删除</text>
        </view>
        
        <view class="form-item">
          <text class="label">项目名称</text>
          <input class="input" placeholder="请输入项目名称" value="{{item.name}}" bindinput="onProjectInput" data-index="{{index}}" data-field="name" />
        </view>
        
        <view class="date-row">
          <view class="form-item date-item">
            <text class="label">开始时间</text>
            <input class="input" placeholder="YYYY-MM" value="{{item.startDate}}" bindinput="onProjectInput" data-index="{{index}}" data-field="startDate" />
          </view>
          
          <view class="form-item date-item">
            <text class="label">结束时间</text>
            <input class="input" placeholder="YYYY-MM" value="{{item.endDate}}" bindinput="onProjectInput" data-index="{{index}}" data-field="endDate" />
          </view>
        </view>
        
        <view class="form-item">
          <text class="label">项目描述</text>
          <textarea class="textarea" placeholder="请描述项目内容、技术栈和您的职责" value="{{item.description}}" bindinput="onProjectInput" data-index="{{index}}" data-field="description" />
        </view>
      </view>
      
      <button class="add-btn" bindtap="addProjectExperience">+ 添加项目经验</button>
    </view>

    <!-- 专业技能部分 -->
    <view class="edit-section" wx:if="{{currentSection === 'skills'}}">
      <view class="form-item">
        <text class="label">专业技能</text>
        <view class="skill-item" wx:for="{{resumeInfo.skillsWithLevel}}" wx:key="index" wx:for-index="index">
          <view class="skill-header">
            <input class="skill-name" placeholder="技能名称" value="{{item.name}}" bindinput="onSkillNameInput" data-index="{{index}}" />
            <view class="skill-actions">
              <view class="level-label">{{skillLevels[item.level - 1] || '选择等级'}}</view>
              <view class="skill-levels">
                <view class="level-item" wx:for="{{skillLevels}}" wx:for-item="levelName" wx:for-index="levelValue" wx:key="levelValue" 
                      class="level-item {{item.level === levelValue + 1 ? 'active' : ''}}" 
                      bindtap="onSkillLevelChange" data-skill-index="{{index}}" data-level="{{levelValue + 1}}">
                  <text>{{levelName}}</text>
                </view>
              </view>
              <view class="delete-btn" bindtap="onDeleteSkill" data-index="{{index}}">删除</view>
            </view>
          </view>
          <view class="progress-container">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.level * 20}}%;"></view>
            </view>
          </view>
        </view>
        
        <button class="add-skill-btn" type="primary" bindtap="onAddSkill">添加技能</button>
      </view>
      
      <view class="tips">
        <text>提示：请列出与应聘职位相关的关键技能，提高简历匹配度</text>
      </view>
    </view>

    <!-- 兴趣爱好部分 -->
    <view class="edit-section" wx:if="{{currentSection === 'hobbies'}}">
      <view class="form-item">
        <text class="label">兴趣爱好</text>
        <textarea class="textarea" placeholder="请列出您的兴趣爱好，如：阅读、运动、摄影等，用逗号分隔" value="{{resumeInfo.hobbiesText}}" bindinput="onHobbiesInput" />
      </view>
      
      <view class="tips">
        <text>提示：适当的兴趣爱好可以展示您的个性特点和生活态度</text>
      </view>
    </view>

    <!-- 自我评价部分 -->
    <view class="edit-section" wx:if="{{currentSection === 'self'}}">
      <view class="form-item">
        <text class="label">自我评价</text>
        <textarea class="textarea" placeholder="请简要评价您的优势、工作态度和职业目标" value="{{resumeInfo.selfEvaluation}}" bindinput="onSelfEvaluationInput" />
      </view>
      
      <view class="tips">
        <text>提示：自我评价应简洁有力，突出您的核心竞争力和职业优势</text>
      </view>
    </view>
  </scroll-view>

  <!-- 底部保存按钮 -->
  <view class="footer">
    <button class="save-btn" type="primary" bindtap="saveResume">保存简历</button>
  </view>
</view>