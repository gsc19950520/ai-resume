<!-- interview.wxml -->
<view class="container">
  
  <!-- ç®€å†é€‰æ‹©å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showResumeSelectModal}}" bindtap="">
    <view class="resume-select-modal" catchtap="">
      <view class="modal-header">
        <view class="modal-title">é€‰æ‹©é¢è¯•ç®€å†</view>
      </view>
      <view class="modal-content">
        <view class="resume-list">
          <view 
            wx:for="{{resumeList}}" 
            wx:key="id" 
            class="resume-item {{selectedResumeId === item.id ? 'selected' : ''}}" 
            bindtap="selectResume" 
            data-id="{{item.id}}"
          >
            <view class="resume-info">
              <view class="resume-title">{{item.title}}</view>
              <view class="resume-occupation">{{item.occupation}}</view>
              <view class="resume-time">æ›´æ–°æ—¶é—´: {{item.updateTime}}</view>
            </view>
            <view class="resume-select-icon" wx:if="{{selectedResumeId === item.id}}">
              <image src="/images/check.png" mode="aspectFit"></image>
            </view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <text class="tips">è¯·é€‰æ‹©ä¸€ä»½ç®€å†ï¼ŒAIå°†åŸºäºç®€å†å†…å®¹ç”Ÿæˆé¢è¯•é—®é¢˜</text>
      </view>
    </view>
  </view>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="header-left" bindtap="goBack">
      <image src="/images/avatar.jpg" mode="aspectFit" class="avatar-icon"></image>
      <view class="job-badge">{{industryJobTag || 'æŠ€æœ¯é¢è¯•'}}</view>
    </view>
    <view class="header-center">AI æ¨¡æ‹Ÿé¢è¯•</view>
    <view class="header-right">
      <view class="progress-area">
        <view class="countdown-timer {{sessionTimeRemaining < 60 ? 'time-warning pulse' : ''}}">
          {{formatRemainingTime(sessionTimeRemaining)}}
        </view>
        <view class="progress-bar">
          <view 
            class="progress-fill"
            style="width: {{(sessionTimeRemaining / data.sessionSeconds) * 100}}%"
          ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢è¯•å®˜é£æ ¼é€‰æ‹©æ¨¡å— - personaSelector -->
  <view class="persona-selector" wx:if="{{false}}">
    <view class="selector-title">é€‰æ‹©é¢è¯•å®˜é£æ ¼</view>
    
    <!-- æ°´å¹³å¡ç‰‡å¸ƒå±€ -->
    <view class="persona-cards">
      <view 
        wx:for="{{personas}}" 
        wx:key="id" 
        class="persona-card persona-{{item.id}} {{persona === item.id ? 'selected' : ''}}"
        bindtap="selectPersona"
        data-id="{{item.id}}"
      >
        <view class="persona-emoji">{{item.emoji}}</view>
        <view class="persona-name">{{item.name}}</view>
      </view>
    </view>
    
    <!-- é¢„è§ˆåŒºåŸŸ -->
    <view class="preview-section" wx:if="{{previewQuestion}}">
      <view class="preview-question">{{previewQuestion}}</view>
    </view>
    
    <!-- å¼€å§‹é¢è¯•æŒ‰é’® -->
    <button 
      class="start-interview-btn {{personaSelected ? 'active' : 'disabled'}}"
      bindtap="startInterview"
      disabled="{{!personaSelected}}"
    >
      å¼€å§‹é¢è¯•
    </button>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- å·¦ä¾§ï¼šAIé—®é¢˜å¡ç‰‡ -->
    <view class="left-column">
      <view class="question-card-wrapper" wx:if="{{!showFeedback}}">
        <view class="question-card {{animationState.questionCard !== 'idle' ? 'fade-in-bottom' : ''}}">
          <view class="question-header">
            <view class="persona-label persona-{{persona}}">
              {{getPersonaText(persona)}}
            </view>
          </view>
          <view class="question-content">{{currentQuestion.content}}</view>
          <view class="hint-text" wx:if="{{currentQuestion.expectedKeyPoints && currentQuestion.expectedKeyPoints.length > 0}}">
            æç¤º: è¯·é‡ç‚¹å›ç­” {{currentQuestion.expectedKeyPoints.join('ã€')}}
          </view>
        </view>
      </view>

      <!-- å†å²è®°å½•é¢æ¿ -->
      <view class="history-panel" wx:if="{{interviewHistory && interviewHistory.length > 0}}">
        <view class="history-header" bindtap="toggleHistory">
          <view class="history-title">å†å²é—®ç­”</view>
          <view class="history-count">{{interviewHistory.length}} æ¡</view>
          <view class="history-toggle">{{historyExpanded ? 'æ”¶èµ·' : 'å±•å¼€'}}</view>
        </view>
        <view class="history-content" wx:if="{{historyExpanded || interviewHistory.length <= 2}}">
          <view wx:for="{{interviewHistory}}" wx:key="index" class="history-item">
            <view class="history-question">{{item.question}}</view>
            <view class="history-answer">{{item.answer.substring(0, 30)}}...</view>
            <view class="history-score">è¯„åˆ†: {{item.score}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å³ä¾§ï¼šç”¨æˆ·å›ç­”é¢æ¿å’ŒAIåé¦ˆå¡ç‰‡ -->
    <view class="right-column">
      <!-- ç­”é¢˜é¢æ¿ - AnswerPanel -->
      <view class="user-answer-panel">
        <view class="panel-header">
          <view class="panel-title">è¯·å›ç­”</view>
          <view class="recording-status" wx:if="{{recording}}">æ­£åœ¨å½•éŸ³...</view>
        </view>
        
        <!-- å½•éŸ³æŒ‰é’® -->
        <view class="record-button-container">
          <button 
            class="record-button {{recording ? 'recording' : ''}}"
            bindtap="toggleRecording"
          >
            <image src="/images/mic_white.png" class="mic-icon"></image>
          </button>
          <view class="record-hint">{{recording ? 'ç‚¹å‡»åœæ­¢' : 'ç‚¹å‡»å½•éŸ³'}}</view>
        </view>

        <!-- è½¬å†™æ–‡æœ¬æ¡† -->
        <view class="transcription-box">
          <!-- è¯­éŸ³è¯†åˆ«çŠ¶æ€æŒ‡ç¤ºå™¨ -->
          <view class="recognition-status-indicator" wx:if="{{recognitionStatus === 'recognizing' || isTranscribing}}">
            <view class="status-dots">
              <view class="dot dot-1"></view>
              <view class="dot dot-2"></view>
              <view class="dot dot-3"></view>
            </view>
            <text class="status-text">è¯­éŸ³è¯†åˆ«ä¸­...</text>
          </view>
          
          <!-- è½¬å†™å†…å®¹æ–‡æœ¬æ¡† -->
          <textarea 
            class="transcription-textarea" 
            placeholder="è¯­éŸ³è½¬æ–‡å­—å†…å®¹ä¼šå®æ—¶æ˜¾ç¤ºåœ¨è¿™é‡Œ"
            value="{{userAnswer}}"
            bindinput="onAnswerInput"
            auto-height
            maxlength="1000"
          ></textarea>
          
          <!-- è¯­éŸ³è¯†åˆ«æç¤º -->
          <view class="transcription-tips">
            <text wx:if="{{!userAnswer}}">ç‚¹å‡»ä¸‹æ–¹éº¦å…‹é£å¼€å§‹å½•éŸ³</text>
            <text wx:else>è¯´çš„å†…å®¹ä¼šå®æ—¶æ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
          </view>
        </view>

        <!-- æäº¤è¡Œ -->
        <view class="submit-row">
          <button 
            class="submit-btn-secondary"
            bindtap="resetRecording"
            disabled="{{!userAnswer}}"
          >
            é‡å½•
          </button>
          <button 
            class="submit-btn-primary"
            bindtap="submitAnswer"
            disabled="{{!userAnswer.trim()}}"
          >
            æäº¤å›ç­”
          </button>
          <button 
            class="submit-btn-secondary"
            bindtap="addNote"
          >
            è¡¥å……è¯´æ˜
          </button>
        </view>
      </view>

      <!-- é—®ç­”è®°å½•åˆ—è¡¨ - InterviewHistoryList -->
      <view class="interview-history-list fade-in" wx:if="true">
        <view class="history-list-header">
          <view class="history-list-title">é—®ç­”è®°å½•</view>
          <view class="history-list-count">å…± {{interviewHistory.length}} æ¡</view>
        </view>
        
        <view class="history-list-content" id="history-list-content">
          <view wx:for="{{interviewHistory}}" wx:key="id" class="history-list-item">
            <!-- é—®é¢˜è®°å½• -->
            <view class="question-block" wx:if="{{item.type === 'question'}}">
              <view class="block-header">
                <view class="block-icon question-icon">
                  <image src="/images/avatar.jpg" mode="aspectFit"></image>
                </view>
                <view class="block-title">é¢è¯•å®˜</view>
                <view class="block-time">{{item.formattedTime}}</view>
              </view>
              <view class="question-content">{{item.content}}</view>
            </view>
            
            <!-- å›ç­”è®°å½• -->
            <view class="answer-block" wx:if="{{item.type === 'answer'}}">
              <view class="block-header">
                <view class="block-icon answer-icon">ğŸ‘¤</view>
                <view class="block-title">æ‚¨çš„å›ç­”</view>
                <view class="block-time">{{item.formattedTime}}</view>
              </view>
              <view class="answer-content">{{item.content}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ§åˆ¶æŒ‰é’® -->
  <view class="footer-controls">
    <button 
      class="footer-btn footer-btn-secondary"
      bindtap="skipQuestion"
      disabled="{{!userAnswer}}"
    >
      è·³è¿‡
    </button>
    <button 
      class="footer-btn footer-btn-warning"
      bindtap="togglePause"
    >
      {{isPaused ? 'ç»§ç»­' : 'æš‚åœ'}}
    </button>
    <button 
      class="footer-btn footer-btn-primary"
      bindtap="finishInterview"
    >
      ç»“æŸå¹¶ç”ŸæˆæŠ¥å‘Š
    </button>
  </view>

  <!-- æ—¶é—´è­¦å‘Šè¦†ç›–å±‚ -->
  <view class="time-warning-overlay" wx:if="{{sessionTimeRemaining < 60}}">
    <view class="warning-content">
      <view class="warning-icon">âš ï¸</view>
      <view class="warning-text">é¢è¯•å³å°†ç»“æŸ</view>
      <view class="warning-time">{{formatRemainingTime(sessionTimeRemaining)}}</view>
    </view>
  </view>
</view>