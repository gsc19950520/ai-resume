<!--pages/growth/report.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="header-left">
      <text class="page-title">AIèŒä¸šæˆé•¿æŠ¥å‘Š</text>
      <text class="subtitle">åŸºäºå†å²é¢è¯•æ•°æ®æ™ºèƒ½ç”Ÿæˆ</text>
    </view>
    <view class="header-actions">
      <view class="action-btn" bindtap="refreshReport">
        <image src="/images/arrow.png" class="icon" mode="aspectFit"></image>
        <text>æ›´æ–°æŠ¥å‘Š</text>
      </view>
      <view class="action-btn" bindtap="downloadPDFReport">
        <image src="/images/arrow.png" class="icon" mode="aspectFit"></image>
        <text>ä¸‹è½½æŠ¥å‘Š</text>
      </view>
      <view class="action-btn" bindtap="shareReport">
        <image src="/images/arrow.png" class="icon" mode="aspectFit"></image>
        <text>åˆ†äº«</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{loadingText}}</text>
  </view>

  <!-- æŠ¥å‘Šå†…å®¹ -->
  <view class="report-container" wx:if="{{!loading && reportData}}">
    <!-- æŠ¥å‘Šæ ‡é¢˜ä¸ç”Ÿæˆä¿¡æ¯ -->
    <view class="report-header">
      <text class="report-title">{{reportData.title}}</text>
      <text class="report-date">ç”Ÿæˆæ—¥æœŸï¼š{{reportData.generateDate}}</text>
    </view>

    <!-- ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-card">
      <view class="stats-item">
        <text class="stats-value">{{reportData.userStats.totalInterviews}}</text>
        <text class="stats-label">é¢è¯•æ¬¡æ•°</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-value">{{reportData.userStats.avgTotalScore}}</text>
        <text class="stats-label">å¹³å‡å¾—åˆ†</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-value">{{reportData.userStats.bestScore}}</text>
        <text class="stats-label">æœ€é«˜å¾—åˆ†</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-value growth-rate">+{{reportData.userStats.growthRate}}%</text>
        <text class="stats-label">æˆé•¿ç‡</text>
      </view>
    </view>

    <!-- æˆé•¿æ›²çº¿å›¾ -->
    <view class="chart-section">
      <text class="section-title">èƒ½åŠ›æˆé•¿æ›²çº¿</text>
      <view class="chart-container">
        <canvas canvas-id="growthChart" class="growth-chart"></canvas>
        <view class="chart-legend">
          <view class="legend-item">
            <view class="legend-dot total"></view>
            <text>æ€»åˆ†</text>
          </view>
          <view class="legend-item">
            <view class="legend-dot tech"></view>
            <text>æŠ€æœ¯</text>
          </view>
          <view class="legend-item">
            <view class="legend-dot depth"></view>
            <text>æ·±åº¦</text>
          </view>
          <!-- å·²ç§»é™¤: é€»è¾‘ã€è¡¨è¾¾å›¾ä¾‹ -->
        </view>
      </view>
    </view>

    <!-- å¼±é¡¹åˆ†æ -->
    <view class="weakpoints-section">
      <text class="section-title">å¸¸è§å¼±é¡¹ Top3</text>
      <view class="weakpoints-list">
        <view class="weakpoint-item" wx:for="{{weakPoints}}" wx:key="index">
          <view class="weakpoint-header">
            <text class="weakpoint-name">{{item.name}}</text>
            <text class="weakpoint-score">å½“å‰è¯„åˆ†ï¼š{{item.score}}</text>
          </view>
          <view class="progress-container">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.score * 10}}%;"></view>
            </view>
            <text class="improvement">â†‘ {{item.improvement}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¨èæ–¹å‘ -->
    <view class="direction-section">
      <text class="section-title">æ¨èèŒä¸šæ–¹å‘</text>
      <view class="direction-card">
        <text class="direction-text">{{recommendedDirection}}</text>
        <view class="direction-icon">ğŸ¯</view>
      </view>
    </view>

    <!-- æˆé•¿è§„åˆ’ -->
    <view class="growth-plan-section">
      <text class="section-title">æœªæ¥3å¹´æˆé•¿è§„åˆ’</text>
      <view class="growth-plan-list">
        <view class="plan-card" wx:for="{{growthPlan}}" wx:key="index" style="border-left-color: {{item.color}}">
          <text class="plan-period">{{item.period}}</text>
          <view class="goals-list">
            <view class="goal-item" wx:for="{{item.goals}}" wx:for-item="goal" wx:for-index="goalIndex" wx:key="goalIndex">
              <view class="goal-number">{{goalIndex + 1}}</view>
              <text class="goal-text">{{goal}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨ä¸‹è½½æŒ‰é’® -->
    <view class="bottom-actions">
      <button class="download-btn" bindtap="downloadPDFReport">
        <image src="/images/arrow.png" class="btn-icon" mode="aspectFit"></image>
        ä¸‹è½½å®Œæ•´PDFæŠ¥å‘Š
      </button>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:if="{{error}}">
    <view class="error-icon">âš ï¸</view>
    <text class="error-text">{{errorMessage}}</text>
    <button class="retry-btn" bindtap="refreshReport">é‡è¯•</button>
  </view>
</view>